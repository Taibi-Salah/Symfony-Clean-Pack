{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h1>Admin Dashboard</h1>
            </div>
            <div class="card-body">
                {% if app.user %}
                    <p>Welcome, <strong>{{ app.user.email }}</strong>! You have the following roles: <strong>{{ app.user.roles|join(', ') }}</strong></p>
                    <a href="{{ path('admin_catalogue')}}" class="btn btn-primary mb-3">Catalogue de pièces</a>

                    <h2>Users</h2>
                    <ul class="list-group mb-3">
                        {% for user in users %}
                            <li class="list-group-item">{{ user.email }} - Roles: {{ user.roles|join(', ') }}</li>
                        {% endfor %}
                    </ul>

                    <h2>Tickets</h2>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Description</th>
                                <th>Date de Début</th>
                                <th>Date de Fin</th>
                                <th>Statut</th>
                                <th>Assigné à</th>
                                <th>Intervention</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ticket in tickets %}
                                <tr>
                                    <td>{{ ticket.id }}</td>
                                    <td>{{ ticket.description }}</td>
                                    <td>{{ ticket.dateStart|date('d/m/Y H:i') }}</td>
                                    <td>{{ ticket.dateEnd|date('d/m/Y H:i') }}</td>
                                    <td>{{ ticket.status }}</td>
                                    <td>{{ ticket.technicien ? ticket.technicien.email : 'Non assigné' }}</td>
                                    <td>{{ ticket.intervention ? ticket.intervention.label : 'Non assigné' }}</td>
                                    <td>
                                        <form method="post" action="{{ path('admin_assign_ticket', {id: ticket.id}) }}">
                                            <select name="technician_id" class="form-select">
                                                <option value="">Choisir un technicien</option>
                                                {% for technician in technicians %}
                                                    <option value="{{ technician.id }}" {% if ticket.technicien and ticket.technicien.id == technician.id %}selected{% endif %}>
                                                        {{ technician.email }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                            <button type="submit" class="btn btn-sm btn-primary mt-2">Assigner</button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <form action="{{ path('app_logout') }}" method="post">
                        <button type="submit" class="btn btn-danger">Logout</button>
                    </form>
                {% else %}
                    <p>You are not logged in.</p>
                    <a href="{{ path('app_login') }}" class="btn btn-primary">Login</a>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}



